<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-3">
            <div class="ibox float-e-margins">
                <div class="ibox-content mailbox-content">

                    <div class="file-manager">
                        <!--                        <a class="btn btn-block btn-primary compose-mail" href="mail_compose.html">Compose Mail</a>-->

                        <i style="font-size: 28px;" class="fa fa-plus-square addProcess"></i>

                        <div class="hiddenRequests col-lg-12 pull-left" style="display:none;">
                            <div class="client-detail" style="height:200px; margin-bottom: 15px;">
                                <strong>Choose a request</strong>

                                <ul class="list-group clear-list">
                                    <li class="list-group-item fist-item">
                                        <span class="pull-right"> 
                                            <button type="button" class="btn btn-xs btn-primary addNewProcess">+</button>
                                        </span>
                                        Please contact me
                                    </li>
                                    <li class="list-group-item">
                                        <span class="pull-right"> 
                                            <button type="button" class="btn btn-xs btn-primary addNewProcess">+</button>
                                        </span>
                                        Sign a contract
                                    </li>
                                    <li class="list-group-item">
                                        <span class="pull-right"> 
                                            <button type="button" class="btn btn-xs btn-primary addNewProcess">+</button>
                                        </span>
                                        Open new shop
                                    </li>
                                    <li class="list-group-item">
                                        <span class="pull-right"> 
                                            <button type="button" class="btn btn-xs btn-primary addNewProcess">+</button>
                                        </span>
                                        Call back to Sylvia
                                    </li>
                                    <li class="list-group-item">
                                        <span class="pull-right"> 
                                            <button type="button" class="btn btn-xs btn-primary addNewProcess">+</button>
                                        </span>
                                        Write a letter to Sandra
                                    </li>
                                </ul>
                            </div>

                        </div>

                        <div class="space-25"></div>
                        <h5>Folders</h5>
                        <ul class="folder-list m-b-md" style="padding: 0">
                            <li><a class="changeStatus" status="1" href="#"> <i class="fa fa-inbox "></i> Inbox <span class="label label-warning pull-right">16</span> </a></li>
                            <li><a class="changeStatus" href="#"> <i class="fa fa-envelope-o"></i> Send Mail</a></li>
                            <li><a class="changeStatus" status="8" href="#" href="mailbox.html"> <i class="fa fa-certificate"></i> Important</a></li>
                            <li><a class="changeStatus" href="#" status="2" href="mailbox.html"> <i class="fa fa-file-text-o"></i> Drafts <span class="label label-danger pull-right">2</span></a></li>
                            <li><a class="changeStatus" href="#" href="mailbox.html"> <i class="fa fa-trash-o"></i> Trash</a></li>
                            <li><a class="changeStatus" href="#" status="3" href="#"> <i class="fa fa-trash-o"></i> Archived</a></li>
                        </ul>
                        <h5>Categories</h5>
                        <ul class="category-list" style="padding: 0">

                            <?php
                            $arrColours = array("text-navy", "text-danger", "text-primary", "text-info", "text-warning");
                            foreach ($arrCounters as $key => $arrCounter):
                                ?>
                                <li><a list-type="<?= $arrCounter['item'] ?>" href="#"> <i class="fa fa-circle <?= $arrColours[$key] ?>"></i> <?= $arrCounter['item'] . " (" . $arrCounter['count'] . ") " ?></a></li>
                            <?php endforeach; ?>
                        </ul>

                        <!--                        <h5 class="tag-title">Labels</h5>
                                                <ul class="tag-list" style="padding: 0">
                                                    <li><a href=""><i class="fa fa-tag"></i> Family</a></li>
                                                    <li><a href=""><i class="fa fa-tag"></i> Work</a></li>
                                                    <li><a href=""><i class="fa fa-tag"></i> Home</a></li>
                                                    <li><a href=""><i class="fa fa-tag"></i> Children</a></li>
                                                    <li><a href=""><i class="fa fa-tag"></i> Holidays</a></li>
                                                    <li><a href=""><i class="fa fa-tag"></i> Music</a></li>
                                                    <li><a href=""><i class="fa fa-tag"></i> Photography</a></li>
                                                    <li><a href=""><i class="fa fa-tag"></i> Film</a></li>
                                                </ul>-->
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-9 animated fadeInRight mainContentWrapper">
            <div class="mail-box-header">

                <form method="get" action="index.html" class="pull-right mail-search">
                    <div class="input-group">
                        <input type="text" class="form-control input-sm" id="search" name="search" placeholder="Search email">
                        <div class="input-group-btn">
                            <button type="button" id="Search" class="btn btn-sm btn-primary">
                                Search
                            </button>
                        </div>
                    </div>
                </form>
                <h2>
                    Inbox (<?= count ($arrNotifications) ?>)
                </h2>
                <div class="mail-tools tooltip-demo m-t-md">

                    <button class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="left" title="Refresh inbox"><i class="fa fa-refresh"></i> Refresh</button>
                    <button class="btn btn-white btn-sm updateStatus" status="5" data-toggle="tooltip" data-placement="top" title="Mark as read"><i class="fa fa-eye"></i> </button>
                    <button class="btn btn-white btn-sm updateStatus" status="6" data-toggle="tooltip" data-placement="top" title="Mark as important"><i class="fa fa-exclamation"></i> </button>
                    <button class="btn btn-white btn-sm updateStatus" status="4" data-toggle="tooltip" data-placement="top" title="Move to trash"><i class="fa fa-trash-o"></i> </button>

                </div>
            </div>
            <div class="mail-box">

                <table class="table table-hover table-mail">

                    <thead>
                        <tr>
                            <th></th>
                            <th>Project Name</th>
                            <th>Subject</th>
                            <th>Step</th>
                            <th>Date Sent</th>
                        </tr>
                    </thead>

                    <tbody>

                        <?php
                        foreach ($arrNotifications as $key => $arrNotification):

                            $arrNotification['project']->setAuditData ();

                            $class = $arrNotification['notifications']->getHasRead () == 0 ? 'unread' : 'read';
                            ?>

                            <tr class="<?= $class ?> mailItem">
                                <td id="<?= $arrNotification['notifications']->getId () ?>" class="check-mail">
                                    <input type="checkbox" class="i-checks">
                                </td>
                                <td class="mail-subject"><a href="mail_detail.html"><?= $arrNotifications[$key]['project']->getName () ?></a></td>
                                <td class="mail-ontact"><a href="mail_detail.html"><?= $arrNotification['notifications']->getSubject () ?></a></td>
                                <td class=""><?= $arrNotification['project']->getCurrent_step () ?></td>

                                <td class="text-right mail-date"><?= $arrNotification['notifications']->getDateSent () ?></td>
                            </tr>

                            <?php
                        endforeach;
                        ?>

                    </tbody>
                </table>


            </div>
        </div>
    </div>
</div>

<script src="/FormBuilder/public/js/plugins/iCheck/icheck.min.js"></script>

<script>
    var selected = [];
    var page = 0;
    var orderBy = "ns.date_sent";
    var orderDir = "DESC";
    var status = 1;
    var listType = null;

    function projectsPage (selectedPage)
    {
        page = selectedPage;

        $.ajax ({
            type: "GET",
            url: "/FormBuilder/inbox/filterProjects/" + listType + "/" + page,
            success: function (response)
            {
                $ (".mail-box").html (response);
                rebind ();
            },
            error: function (request, status, error)
            {
                console.log ("critical errror occured");
            }
        });
    }

    $ (".category-list > li > a").off ();
    $ (".category-list > li > a").on ("click", function ()
    {
        listType = $ (this).attr ("list-type");
        page = 0;

        $.ajax ({
            type: "GET",
            url: "/FormBuilder/inbox/filterProjects/" + listType + "/" + page,
            success: function (response)
            {
                $ (".mail-box").html (response);
                rebind ();
            },
            error: function (request, status, error)
            {
                console.log ("critical errror occured");
            }
        });
    });

    function rebind ()
    {
        $ ('.i-checks').iCheck ({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
        });

        $ ('.i-checks').on ('ifChecked', function (event)
        {
            var id = $ (this).parent ().parent ().attr ("id");
            selected.push (id);
            console.log (id);
        });

        $ (".mailItem").on ("click", function ()
        {
            var id = $ (this).find (".check-mail").attr ("id");

            $.ajax ({
                type: "GET",
                url: "/FormBuilder/inbox/getMessage/" + id,
                success: function (response)
                {
                    $ (".mainContentWrapper").html (response);
                    rebind ();
                },
                error: function (request, status, error)
                {
                    console.log ("critical errror occured");
                }
            });

            return false;
        });
    }

    function search ()
    {
        var searchText = $ ("#search").val ();

        $.ajax ({
            type: "POST",
            url: "/FormBuilder/inbox/searchMessages/" + status + "/" + page + "/" + orderBy + "/" + orderDir,
            data: {"searchText": searchText},
            success: function (response)
            {
                $ (".mail-box").html (response);
                rebind ();
            },
            error: function (request, status, error)
            {
                console.log ("critical errror occured");
            }
        })
    }

    function jumpToPage (pageNo)
    {
        page = pageNo;
        search ();
    }

    $ (document).ready (function ()
    {
        search ();

        $ ("#Search").on ("click", function ()
        {
            search ();
        });

        $ (".addProcess").on ("click", function ()
        {
            $ (".hiddenRequests").slideToggle ();
        });

        rebind ();

        $ (".updateStatus").on ("click", function ()
        {
            var status = $ (this).attr ("status");

            $.ajax ({
                type: "POST",
                data: {"selected": selected},
                url: "/FormBuilder/inbox/updateStatus/" + status,
                success: function (response)
                {
                    alert (response);
                },
                error: function (request, status, error)
                {
                    console.log ("critical errror occured");
                }
            })
        });

        $ (".changeStatus").on ("click", function ()
        {
            status = $ (this).attr ("status");
            page = 0;

            search ();
        });
    });

</script>